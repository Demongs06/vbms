<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demon's Workshop - 24/7 Breakdown Service</title>
    <link rel="stylesheet" href="style.css">
<script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <!-- Customer Navigation -->
    <nav id="customer-nav" class="customer-nav">
        <div class="nav-container">
            <div class="nav-logo">
                <span class="logo-icon">üöó</span>
                <span class="logo-text">Demon's Workshop</span>
            </div>
            <button class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="#" data-page="home" class="nav-link active">Home</a></li>
                <li><a href="#" data-page="request-help" class="nav-link">Request Help</a></li>
                <li><a href="#" data-page="pay-bill" class="nav-link">Pay Bill</a></li>
                <li><a href="#" data-page="contact" class="nav-link">Contact</a></li>
                <li><a href="#" id="adminLoginLink" class="nav-link admin-link">Admin Login</a></li>
            </ul>
        </div>
    </nav>

    <!-- Admin Navigation -->
    <nav id="admin-nav" class="admin-nav hidden">
        <div class="admin-nav-header">
            <div class="nav-logo">
                <span class="logo-icon">üöó</span>
                <span class="logo-text">Demon's Workshop Admin</span>
            </div>
            <button class="admin-nav-toggle" id="adminNavToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <ul class="admin-nav-menu" id="adminNavMenu">
            <li><a href="#" data-page="admin-dashboard" class="admin-nav-link">üìä Dashboard</a></li>
            <li><a href="#" data-page="admin-requests" class="admin-nav-link">üìã Requests</a></li>
            <li><a href="#" data-page="admin-staff" class="admin-nav-link">üë• Staff Management</a></li>
            <li><a href="#" data-page="admin-bills" class="admin-nav-link">üí∞ Bills</a></li>
            <li><a href="#" id="adminLogout" class="admin-nav-link logout-link">üö™ Logout</a></li>
        </ul>
    </nav>

    <!-- Main Content Container -->
    <div id="main-content" class="main-content">
        
        <!-- HOME PAGE -->
        <div id="home-page" class="page active">
            <!-- Hero Section -->
            <section class="hero">
                <div class="hero-content">
                    <h1 class="hero-title">24/7 Vehicle Breakdown Assistance</h1>
                    <p class="hero-subtitle">Fast, reliable help when you need it most. Available across Mumbai and surrounding areas.</p>
                    <button class="btn btn--primary btn--lg" id="heroRequestBtn">Request Help Now</button>
                </div>
            </section>

            <!-- Services Section -->
            <section class="services">
                <div class="container">
                    <h2 class="section-title">Our Services</h2>
                    <div class="services-grid">
                        <div class="service-card">
                            <div class="service-icon">üöõ</div>
                            <h3>Towing</h3>
                            <p>Professional towing service to the nearest garage or your preferred location.</p>
                        </div>
                        <div class="service-card">
                            <div class="service-icon">üõû</div>
                            <h3>Flat Tire</h3>
                            <p>Quick tire replacement and repair services on the spot.</p>
                        </div>
                        <div class="service-card">
                            <div class="service-icon">‚ö°</div>
                            <h3>Jump Start</h3>
                            <p>Battery dead? We'll get you started in minutes.</p>
                        </div>
                        <div class="service-card">
                            <div class="service-icon">‚õΩ</div>
                            <h3>Fuel Delivery</h3>
                            <p>Ran out of fuel? We'll deliver it right to your location.</p>
                        </div>
                        <div class="service-card">
                            <div class="service-icon">üîß</div>
                            <h3>Engine Repair</h3>
                            <p>Expert mechanics to diagnose and fix engine issues on-site.</p>
                        </div>
                        <div class="service-card">
                            <div class="service-icon">üîã</div>
                            <h3>Battery Replacement</h3>
                            <p>Complete battery replacement service with quality batteries.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Reviews Section -->
            <section class="reviews">
                <div class="container">
                    <h2 class="section-title">What Our Customers Say</h2>
                    <div class="reviews-header">
                        <div class="average-rating">
                            <div class="rating-number" id="avgRating">4.5</div>
                            <div class="stars" id="avgStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                            <div class="rating-count" id="ratingCount">Based on 2 reviews</div>
                        </div>
                    </div>
                    <div class="reviews-grid" id="reviewsGrid">
                        <!-- Reviews will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Footer -->
            <footer class="footer">
                <div class="container">
                    <div class="footer-grid">
                        <div class="footer-section">
                            <h4>QuickFix Assistance</h4>
                            <p>Your trusted partner for vehicle breakdown services across Mumbai.</p>
                        </div>
                        <div class="footer-section">
                            <h4>Contact</h4>
                            <p>üìû +91 9876543210</p>
                            <p>üìß support@quickfix.com</p>
                            <p>üìç Mumbai, Maharashtra</p>
                        </div>
                        <div class="footer-section">
                            <h4>Quick Links</h4>
                            <p><a href="#" data-page="home">Home</a></p>
                            <p><a href="#" data-page="request-help">Request Help</a></p>
                            <p><a href="#" data-page="contact">Contact Us</a></p>
                        </div>
                    </div>
                    <div class="footer-bottom">
                        <p>&copy; 2025 QuickFix Vehicle Assistance. All rights reserved.</p>
                    </div>
                </div>
            </footer>
        </div>

        <!-- REQUEST HELP PAGE -->
        <div id="request-help-page" class="page">
            <div class="container page-container">
                <h1 class="page-title">Request Breakdown Assistance</h1>
                <div class="form-card">
                    <form id="requestHelpForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" id="customerPhone" placeholder="+91 XXXXXXXXXX" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="customerEmail" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Vehicle Type *</label>
                                <select class="form-control" id="vehicleType" required>
                                    <option value="">Select vehicle type</option>
                                    <option value="Car">Car</option>
                                    <option value="Bike">Bike</option>
                                    <option value="Truck">Truck</option>
                                    <option value="Auto">Auto Rickshaw</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Vehicle Number *</label>
                                <input type="text" class="form-control" id="vehicleNumber" placeholder="MH-02-XX-1234" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Problem Type *</label>
                                <select class="form-control" id="problemType" required>
                                    <option value="">Select problem type</option>
                                    <option value="Oil Leakage">Oil Leakage</option>
                                    <option value="Breakdown">Breakdown</option>
                                    <option value="Puncture">Puncture</option>
                                    <option value="Engine Failure">Engine Failure</option>
                                    <option value="Battery Issue">Battery Issue</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Problem Description</label>
                            <textarea class="form-control" id="problemDescription" rows="3" placeholder="Describe the issue in detail..."></textarea>
                        </div>
                        
                        <!-- Location Picker with Leaflet Map -->
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-xl font-semibold mb-4">Select Your Location</h2>
                        <div id="requestMap" class="h-96 rounded-lg border border-gray-300 mb-4 z-0"></div>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Latitude</label>
                                <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-50" id="latitude" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Longitude</label>
                                <input type="text" class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-50" id="longitude" readonly>
                            </div>
                        </div>
                        <button type="button" class="w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg transition" id="useCurrentLocation">üìç Use Current Location</button>
                        <p class="text-xs text-gray-500 mt-2">Drag the marker to select your exact location</p>
                    </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn--primary btn--lg">Submit Request</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- PAY BILL PAGE -->
        <div id="pay-bill-page" class="page">
            <div class="container page-container">
                <h1 class="page-title">Pay Bill</h1>
                
                <div id="billSelection" class="form-card">
                    <h3>Select Your Bill</h3>
                    <div class="form-group">
                        <label class="form-label">Enter Request ID</label>
                        <input type="text" class="form-control" id="billRequestId" placeholder="Enter your request ID (e.g., 1001)">
                    </div>
                    <button class="btn btn--primary" id="loadBillBtn">Load Bill</button>
                </div>

                <div id="billDetails" class="form-card hidden">
                    <h3>Bill Details</h3>
                    <div class="bill-info">
                        <div class="bill-row">
                            <span>Request ID:</span>
                            <span id="billId"></span>
                        </div>
                        <div class="bill-row">
                            <span>Customer Name:</span>
                            <span id="billCustomerName"></span>
                        </div>
                        <div class="bill-row">
                            <span>Service Type:</span>
                            <span id="billServiceType"></span>
                        </div>
                        <div class="bill-row">
                            <span>Service Date:</span>
                            <span id="billDate"></span>
                        </div>
                        <div class="bill-row">
                            <span>Base Amount:</span>
                            <span id="billBaseAmount"></span>
                        </div>
                        <div class="bill-row">
                            <span>Additional Charges:</span>
                            <span id="billAdditionalCharges"></span>
                        </div>
                        <div class="bill-row">
                            <span>Tax (18% GST):</span>
                            <span id="billTax"></span>
                        </div>
                        <div class="bill-row total">
                            <span>Total Amount:</span>
                            <span id="billTotal"></span>
                        </div>
                    </div>

                    <form id="paymentForm">
                        <h4>Payment Details</h4>
                        <div class="form-group">
                            <label class="form-label">Payment Method</label>
                            <select class="form-control" id="paymentMethod" required>
                                <option value="">Select payment method</option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="Debit Card">Debit Card</option>
                                <option value="UPI">UPI</option>
                                <option value="Net Banking">Net Banking</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Card Number</label>
                            <input type="text" class="form-control" id="cardNumber" placeholder="XXXX XXXX XXXX XXXX" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Expiry Date</label>
                                <input type="text" class="form-control" id="expiryDate" placeholder="MM/YY" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">CVV</label>
                                <input type="text" class="form-control" id="cvv" placeholder="XXX" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn--primary btn--lg">Pay Now</button>
                    </form>
                </div>

                <div id="reviewForm" class="form-card hidden">
                    <h3>Write a Review</h3>
                    <p>Thank you for your payment! Please share your experience:</p>
                    <form id="submitReviewForm">
                        <div class="form-group">
                            <label class="form-label">Rating</label>
                            <div class="star-rating" id="starRating">
                                <span class="star" data-rating="1">‚òÜ</span>
                                <span class="star" data-rating="2">‚òÜ</span>
                                <span class="star" data-rating="3">‚òÜ</span>
                                <span class="star" data-rating="4">‚òÜ</span>
                                <span class="star" data-rating="5">‚òÜ</span>
                            </div>
                            <input type="hidden" id="reviewRating" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Your Review</label>
                            <textarea class="form-control" id="reviewText" rows="4" placeholder="Share your experience with our service..." required></textarea>
                        </div>
                        <button type="submit" class="btn btn--primary">Submit Review</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- CONTACT PAGE -->
        <div id="contact-page" class="page">
            <div class="container page-container">
                <h1 class="page-title">Contact Us</h1>
                <div class="contact-grid">
                    <div class="contact-info">
                        <h3>Get in Touch</h3>
                        <div class="contact-item">
                            <div class="contact-icon">üìû</div>
                            <div>
                                <h4>Phone</h4>
                                <p>+91 9876543210</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">üìß</div>
                            <div>
                                <h4>Email</h4>
                                <p>support@demonsworkshop.com</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">üìç</div>
                            <div>
                                <h4>Address</h4>
                                <p>Mumbai, Maharashtra, India</p>
                            </div>
                        </div>
                        <div class="contact-item">
                            <div class="contact-icon">‚è∞</div>
                            <div>
                                <h4>Working Hours</h4>
                                <p>24/7 Emergency Service</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADMIN LOGIN PAGE -->
        <div id="admin-login-page" class="page">
            <div class="admin-login-container">
                <div class="login-card">
                    <div class="login-header">
                        <span class="logo-icon">üöó</span>
                        <h2>Admin Login</h2>
                    </div>
                    <form id="adminLoginForm">
                        <div class="form-group">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="adminUsername" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="adminPassword" required>
                        </div>
                        <button type="submit" class="btn btn--primary btn--full-width">Login</button>
                    </form>
                    <p class="login-hint">Default: admin / admin123</p>
                </div>
            </div>
        </div>

        <!-- ADMIN DASHBOARD -->
        <div id="admin-dashboard-page" class="page admin-page">
            <div class="admin-content">
                <h1 class="page-title">Dashboard Overview</h1>
                
                <div class="dashboard-cards">
                    <div class="dashboard-card" style="background: var(--color-bg-1);">
                        <div class="dashboard-icon">üìã</div>
                        <div class="dashboard-info">
                            <div class="dashboard-label">Total Requests</div>
                            <div class="dashboard-value" id="totalRequests">0</div>
                        </div>
                    </div>
                    <div class="dashboard-card" style="background: var(--color-bg-3);">
                        <div class="dashboard-icon">‚úÖ</div>
                        <div class="dashboard-info">
                            <div class="dashboard-label">Completed</div>
                            <div class="dashboard-value" id="completedRequests">0</div>
                        </div>
                    </div>
                    <div class="dashboard-card" style="background: var(--color-bg-2);">
                        <div class="dashboard-icon">‚è≥</div>
                        <div class="dashboard-info">
                            <div class="dashboard-label">Pending</div>
                            <div class="dashboard-value" id="pendingRequests">0</div>
                        </div>
                    </div>
                    <div class="dashboard-card" style="background: var(--color-bg-5);">
                        <div class="dashboard-icon">üë•</div>
                        <div class="dashboard-info">
                            <div class="dashboard-label">Total Staff</div>
                            <div class="dashboard-value" id="totalStaff">0</div>
                        </div>
                    </div>
                    <div class="dashboard-card" style="background: var(--color-bg-8);">
                        <div class="dashboard-icon">üí∞</div>
                        <div class="dashboard-info">
                            <div class="dashboard-label">Total Revenue</div>
                            <div class="dashboard-value" id="totalRevenue">‚Çπ0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card__header">
                        <h3>Recent Requests</h3>
                    </div>
                    <div class="card__body">
                        <div class="table-container">
                            <table class="data-table" id="dashboardRequestsTable">
                                <thead>
                                    <tr>
                                        <th>Request ID</th>
                                        <th>Customer</th>
                                        <th>Vehicle</th>
                                        <th>Problem</th>
                                        <th>Status</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADMIN REQUESTS PAGE -->
        <div id="admin-requests-page" class="page admin-page">
            <div class="admin-content">
                <div class="page-header">
                    <h1 class="page-title">Request Management</h1>
                    <div class="page-actions">
                        <select class="form-control" id="requestStatusFilter">
                            <option value="All">All Requests</option>
                            <option value="Pending">Pending</option>
                            <option value="Accepted">Accepted</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div class="card__body">
                        <div class="table-container">
                            <table class="data-table" id="requestsTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Customer</th>
                                        <th>Phone</th>
                                        <th>Vehicle</th>
                                        <th>Problem</th>
                                        <th>Location</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADMIN STAFF MANAGEMENT PAGE -->
        <div id="admin-staff-page" class="page admin-page">
            <div class="admin-content">
                <div class="page-header">
                    <h1 class="page-title">Staff Management</h1>
                    <button class="btn btn--primary" id="addStaffBtn">+ Add Staff</button>
                </div>

                <div class="tabs">
                    <button class="tab-btn active" data-tab="drivers">Drivers</button>
                    <button class="tab-btn" data-tab="mechanics">Mechanics</button>
                </div>

                <div class="tab-content active" id="drivers-tab">
                    <div class="card">
                        <div class="card__body">
                            <div class="table-container">
                                <table class="data-table" id="driversTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Phone</th>
                                            <th>Email</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="mechanics-tab">
                    <div class="card">
                        <div class="card__body">
                            <div class="table-container">
                                <table class="data-table" id="mechanicsTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Phone</th>
                                            <th>Email</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADMIN BILLS PAGE -->
        <div id="admin-bills-page" class="page admin-page">
            <div class="admin-content">
                <h1 class="page-title">Bill Management</h1>
                
                <div class="card">
                    <div class="card__body">
                        <div class="table-container">
                            <table class="data-table" id="billsTable">
                                <thead>
                                    <tr>
                                        <th>Bill ID</th>
                                        <th>Request ID</th>
                                        <th>Customer</th>
                                        <th>Service Type</th>
                                        <th>Amount</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification hidden"></div>

    <!-- Modal Container -->
    <div id="modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        // Data Storage (In-Memory)
let customers = [
  { id: 1, name: 'Rajesh Kumar', phone: '+91 9876543210', email: 'rajesh.kumar@email.com' },
  { id: 2, name: 'Priya Sharma', phone: '+91 9876543211', email: 'priya.sharma@email.com' },
  { id: 3, name: 'Amit Patel', phone: '+91 9876543212', email: 'amit.patel@email.com' }
];

let requests = [
  {
    id: 1001,
    customerId: 1,
    customerName: 'Rajesh Kumar',
    phone: '+91 9876543210',
    vehicleType: 'Car',
    vehicleNumber: 'MH-02-AB-1234',
    problemType: 'Engine Failure',
    description: 'Car engine suddenly stopped while driving',
    latitude: 19.0760,
    longitude: 72.8777,
    status: 'Completed',
    assignedDriver: 'Vikram Singh',
    assignedMechanic: 'Suresh Patil',
    createdDate: '2025-10-28'
  },
  {
    id: 1002,
    customerId: 2,
    customerName: 'Priya Sharma',
    phone: '+91 9876543211',
    vehicleType: 'Bike',
    vehicleNumber: 'MH-12-XY-5678',
    problemType: 'Puncture',
    description: 'Flat tire on highway',
    latitude: 19.1136,
    longitude: 72.8697,
    status: 'In Progress',
    assignedDriver: 'Ravi Kumar',
    assignedMechanic: 'Mohan Das',
    createdDate: '2025-10-29'
  },
  {
    id: 1003,
    customerId: 3,
    customerName: 'Amit Patel',
    phone: '+91 9876543212',
    vehicleType: 'Car',
    vehicleNumber: 'MH-03-CD-9012',
    problemType: 'Oil Leakage',
    description: 'Oil leaking from engine',
    latitude: 19.0896,
    longitude: 72.8656,
    status: 'Pending',
    assignedDriver: null,
    assignedMechanic: null,
    createdDate: '2025-10-29'
  }
];

let staff = [
  { id: 101, name: 'Vikram Singh', phone: '+91 9988776655', email: 'vikram.singh@assistance.com', type: 'Driver', available: true },
  { id: 102, name: 'Ravi Kumar', phone: '+91 9988776656', email: 'ravi.kumar@assistance.com', type: 'Driver', available: false },
  { id: 201, name: 'Suresh Patil', phone: '+91 9988776657', email: 'suresh.patil@assistance.com', type: 'Mechanic', available: true },
  { id: 202, name: 'Mohan Das', phone: '+91 9988776658', email: 'mohan.das@assistance.com', type: 'Mechanic', available: false }
];

let bills = [
  {
    id: 5001,
    requestId: 1001,
    customerName: 'Rajesh Kumar',
    serviceType: 'Engine Failure',
    baseAmount: 3000,
    additionalCharges: 500,
    tax: 630,
    total: 4130,
    status: 'Paid',
    createdDate: '2025-10-28'
  },
  {
    id: 5002,
    requestId: 1002,
    customerName: 'Priya Sharma',
    serviceType: 'Puncture',
    baseAmount: 500,
    additionalCharges: 0,
    tax: 90,
    total: 590,
    status: 'Unpaid',
    createdDate: '2025-10-29'
  }
];

let reviews = [
  {
    id: 1,
    requestId: 1001,
    customerName: 'Rajesh Kumar',
    rating: 5,
    reviewText: 'Excellent service! The mechanic arrived quickly and fixed my car in no time.',
    serviceType: 'Engine Failure',
    createdDate: '2025-10-28'
  },
  {
    id: 2,
    requestId: 1004,
    customerName: 'Sneha Reddy',
    rating: 4,
    reviewText: 'Good service, but took a bit longer than expected. Overall satisfied.',
    serviceType: 'Jump Start',
    createdDate: '2025-10-27'
  }
];

// Admin State
let isAdminLoggedIn = false;
let currentBillRequestId = null;
let selectedRating = 0;

// Auto-increment IDs
let nextRequestId = 1004;
let nextCustomerId = 4;
let nextStaffId = 203;
let nextBillId = 5003;
let nextReviewId = 3;

// Navigation Functions
function showPage(pageName) {
  // Hide all pages
  document.querySelectorAll('.page').forEach(page => {
    page.classList.remove('active');
  });

  // Show requested page
  const page = document.getElementById(pageName + '-page');
  if (page) {
    page.classList.add('active');
  }

  // Update navigation active states
  document.querySelectorAll('.nav-link').forEach(link => {
    link.classList.remove('active');
  });
  document.querySelectorAll('.admin-nav-link').forEach(link => {
    link.classList.remove('active');
  });

  const activeLink = document.querySelector(`[data-page="${pageName}"]`);
  if (activeLink) {
    activeLink.classList.add('active');
  }

  // Initialize page-specific content
  if (pageName === 'home') {
    renderReviews();
  } else if (pageName === 'admin-dashboard') {
    renderAdminDashboard();
  } else if (pageName === 'admin-requests') {
    renderRequestsTable();
  } else if (pageName === 'admin-staff') {
    renderStaffTables();
  } else if (pageName === 'admin-bills') {
    renderBillsTable();
  }
}

function showNotification(message, type = 'success') {
  const notification = document.getElementById('notification');
  notification.textContent = message;
  notification.className = `notification ${type}`;
  notification.classList.remove('hidden');

  setTimeout(() => {
    notification.classList.add('hidden');
  }, 3000);
}

function showModal(content) {
  const modal = document.getElementById('modal');
  const modalBody = document.getElementById('modalBody');
  modalBody.innerHTML = content;
  modal.classList.remove('hidden');
}

function hideModal() {
  document.getElementById('modal').classList.add('hidden');
}

// Customer Side Functions
function renderReviews() {
  const reviewsGrid = document.getElementById('reviewsGrid');
  const avgRatingEl = document.getElementById('avgRating');
  const avgStarsEl = document.getElementById('avgStars');
  const ratingCountEl = document.getElementById('ratingCount');

  // Calculate average rating
  const avgRating = reviews.length > 0
    ? (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1)
    : 0;

  avgRatingEl.textContent = avgRating;
  avgStarsEl.textContent = '‚òÖ'.repeat(Math.round(avgRating)) + '‚òÜ'.repeat(5 - Math.round(avgRating));
  ratingCountEl.textContent = `Based on ${reviews.length} reviews`;

  // Render reviews
  reviewsGrid.innerHTML = reviews.map(review => `
    <div class="review-card">
      <div class="review-header">
        <div>
          <div class="review-author">${review.customerName}</div>
          <div class="review-date">${review.createdDate}</div>
        </div>
        <div class="review-rating">${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5 - review.rating)}</div>
      </div>
      <div class="review-service">${review.serviceType}</div>
      <p class="review-text">${review.reviewText}</p>
    </div>
  `).join('');
}

// Global map instance
let requestMap = null;
let requestMarker = null;
let accuracyCircle = null;

function initRequestMap() {
  // Initialize Leaflet map
  const defaultLat = 19.0760;
  const defaultLon = 72.8777;
  
  requestMap = L.map('requestMap').setView([defaultLat, defaultLon], 13);
  
  // Add OpenStreetMap tiles
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors',
    maxZoom: 19
  }).addTo(requestMap);
  
  // Add draggable marker
  requestMarker = L.marker([defaultLat, defaultLon], {
    draggable: true
  }).addTo(requestMap);
  
  // Update coordinates on drag
  requestMarker.on('dragend', function(e) {
    const position = requestMarker.getLatLng();
    document.getElementById('latitude').value = position.lat.toFixed(6);
    document.getElementById('longitude').value = position.lng.toFixed(6);
  });
  
  // Set initial coordinates
  document.getElementById('latitude').value = defaultLat.toFixed(6);
  document.getElementById('longitude').value = defaultLon.toFixed(6);
  
  // Use Current Location button
  document.getElementById('useCurrentLocation').addEventListener('click', () => {
    if (navigator.geolocation) {
      showNotification('Detecting your location...', 'info');
      navigator.geolocation.getCurrentPosition(
        function(position) {
          const lat = position.coords.latitude;
          const lng = position.coords.longitude;
          const accuracy = position.coords.accuracy;
          
          // Move map and marker to user's location
          requestMap.setView([lat, lng], 16);
          requestMarker.setLatLng([lat, lng]);
          
          // Remove old accuracy circle if exists
          if (accuracyCircle) {
            requestMap.removeLayer(accuracyCircle);
          }
          
          // Add accuracy circle
          accuracyCircle = L.circle([lat, lng], {
            radius: accuracy,
            color: '#3b82f6',
            fillColor: '#3b82f6',
            fillOpacity: 0.1,
            weight: 1
          }).addTo(requestMap);
          
          // Update coordinate inputs
          document.getElementById('latitude').value = lat.toFixed(6);
          document.getElementById('longitude').value = lng.toFixed(6);
          
          showNotification('Location detected successfully!', 'success');
        },
        function(error) {
          showNotification('Could not detect location. Please drag the marker manually.', 'error');
        },
        {
          enableHighAccuracy: true,
          timeout: 5000,
          maximumAge: 0
        }
      );
    } else {
      showNotification('Geolocation is not supported by your browser.', 'error');
    }
  });
  
  // Invalidate size after map is displayed
  setTimeout(() => {
    requestMap.invalidateSize();
  }, 100);
}

function handleRequestHelpSubmit(e) {
  e.preventDefault();

  const customerName = document.getElementById('customerName').value;
  const customerPhone = document.getElementById('customerPhone').value;
  const customerEmail = document.getElementById('customerEmail').value;
  const vehicleType = document.getElementById('vehicleType').value;
  const vehicleNumber = document.getElementById('vehicleNumber').value;
  const problemType = document.getElementById('problemType').value;
  const description = document.getElementById('problemDescription').value;
  const latitude = parseFloat(document.getElementById('latitude').value);
  const longitude = parseFloat(document.getElementById('longitude').value);

  // Create or find customer
  let customer = customers.find(c => c.email === customerEmail);
  if (!customer) {
    customer = {
      id: nextCustomerId++,
      name: customerName,
      phone: customerPhone,
      email: customerEmail
    };
    customers.push(customer);
  }

  // Create request
  const request = {
    id: nextRequestId++,
    customerId: customer.id,
    customerName: customerName,
    phone: customerPhone,
    vehicleType: vehicleType,
    vehicleNumber: vehicleNumber,
    problemType: problemType,
    description: description,
    latitude: latitude,
    longitude: longitude,
    status: 'Pending',
    assignedDriver: null,
    assignedMechanic: null,
    createdDate: new Date().toISOString().split('T')[0]
  };

  requests.push(request);

  showNotification(`Request submitted successfully! Your Request ID is: ${request.id}`, 'success');
  e.target.reset();
  document.getElementById('latitude').value = '19.0760';
  document.getElementById('longitude').value = '72.8777';
  setTimeout(() => showPage('home'), 2000);
}

function loadBill() {
  const requestId = parseInt(document.getElementById('billRequestId').value);
  const request = requests.find(r => r.id === requestId);

  if (!request) {
    showNotification('Request not found!', 'error');
    return;
  }

  if (request.status !== 'Completed') {
    showNotification('Service not completed yet. Cannot generate bill.', 'warning');
    return;
  }

  let bill = bills.find(b => b.requestId === requestId);

  if (!bill) {
    // Generate new bill
    const baseAmount = Math.floor(Math.random() * 3000) + 500;
    const additionalCharges = Math.floor(Math.random() * 500);
    const tax = Math.round((baseAmount + additionalCharges) * 0.18);
    const total = baseAmount + additionalCharges + tax;

    bill = {
      id: nextBillId++,
      requestId: requestId,
      customerName: request.customerName,
      serviceType: request.problemType,
      baseAmount: baseAmount,
      additionalCharges: additionalCharges,
      tax: tax,
      total: total,
      status: 'Unpaid',
      createdDate: new Date().toISOString().split('T')[0]
    };
    bills.push(bill);
  }

  currentBillRequestId = requestId;

  // Display bill
  document.getElementById('billId').textContent = requestId;
  document.getElementById('billCustomerName').textContent = bill.customerName;
  document.getElementById('billServiceType').textContent = bill.serviceType;
  document.getElementById('billDate').textContent = bill.createdDate;
  document.getElementById('billBaseAmount').textContent = '‚Çπ' + bill.baseAmount;
  document.getElementById('billAdditionalCharges').textContent = '‚Çπ' + bill.additionalCharges;
  document.getElementById('billTax').textContent = '‚Çπ' + bill.tax;
  document.getElementById('billTotal').textContent = '‚Çπ' + bill.total;

  document.getElementById('billSelection').classList.add('hidden');
  document.getElementById('billDetails').classList.remove('hidden');
}

function handlePayment(e) {
  e.preventDefault();

  const bill = bills.find(b => b.requestId === currentBillRequestId);
  if (bill) {
    bill.status = 'Paid';
  }

  showNotification('Payment successful!', 'success');
  document.getElementById('billDetails').classList.add('hidden');
  document.getElementById('reviewForm').classList.remove('hidden');
}

function handleReviewSubmit(e) {
  e.preventDefault();

  const request = requests.find(r => r.id === currentBillRequestId);
  const reviewText = document.getElementById('reviewText').value;

  const review = {
    id: nextReviewId++,
    requestId: currentBillRequestId,
    customerName: request.customerName,
    rating: selectedRating,
    reviewText: reviewText,
    serviceType: request.problemType,
    createdDate: new Date().toISOString().split('T')[0]
  };

  reviews.push(review);

  showNotification('Thank you for your review!', 'success');
  setTimeout(() => {
    showPage('home');
    document.getElementById('billSelection').classList.remove('hidden');
    document.getElementById('billDetails').classList.add('hidden');
    document.getElementById('reviewForm').classList.add('hidden');
    document.getElementById('billRequestId').value = '';
    document.getElementById('reviewText').value = '';
    selectedRating = 0;
  }, 2000);
}

// Admin Side Functions
function handleAdminLogin(e) {
  e.preventDefault();

  const username = document.getElementById('adminUsername').value;
  const password = document.getElementById('adminPassword').value;

  if (username === 'admin' && password === 'admin123') {
    isAdminLoggedIn = true;
    document.getElementById('customer-nav').classList.add('hidden');
    document.getElementById('admin-nav').classList.remove('hidden');
    showPage('admin-dashboard');
    showNotification('Login successful!', 'success');
  } else {
    showNotification('Invalid credentials!', 'error');
  }
}

function handleAdminLogout() {
  isAdminLoggedIn = false;
  document.getElementById('customer-nav').classList.remove('hidden');
  document.getElementById('admin-nav').classList.add('hidden');
  showPage('home');
  showNotification('Logged out successfully!', 'success');
}

function renderAdminDashboard() {
  // Update dashboard stats
  document.getElementById('totalRequests').textContent = requests.length;
  document.getElementById('completedRequests').textContent = requests.filter(r => r.status === 'Completed').length;
  document.getElementById('pendingRequests').textContent = requests.filter(r => r.status === 'Pending').length;
  document.getElementById('totalStaff').textContent = staff.length;
  document.getElementById('totalRevenue').textContent = '‚Çπ' + bills.filter(b => b.status === 'Paid').reduce((sum, b) => sum + b.total, 0);

  // Render recent requests
  const tbody = document.querySelector('#dashboardRequestsTable tbody');
  tbody.innerHTML = requests.slice(-5).reverse().map(request => `
    <tr>
      <td>${request.id}</td>
      <td>${request.customerName}</td>
      <td>${request.vehicleNumber}</td>
      <td>${request.problemType}</td>
      <td><span class="status-badge status-${request.status.toLowerCase().replace(' ', '-')}">${request.status}</span></td>
      <td>${request.createdDate}</td>
    </tr>
  `).join('');
}

function renderRequestsTable(filterStatus = 'All') {
  const filteredRequests = filterStatus === 'All'
    ? requests
    : requests.filter(r => r.status === filterStatus);

  const tbody = document.querySelector('#requestsTable tbody');
  tbody.innerHTML = filteredRequests.map(request => `
    <tr>
      <td>${request.id}</td>
      <td>${request.customerName}</td>
      <td>${request.phone}</td>
      <td>${request.vehicleNumber}</td>
      <td>${request.problemType}</td>
      <td>${request.latitude.toFixed(4)}, ${request.longitude.toFixed(4)}</td>
      <td><span class="status-badge status-${request.status.toLowerCase().replace(' ', '-')}">${request.status}</span></td>
      <td>
        <div class="action-buttons">
          <button class="btn btn--sm btn--outline" onclick="viewRequestDetails(${request.id})">View</button>
          ${request.status === 'Pending' ? `<button class="btn btn--sm btn--primary" onclick="acceptRequest(${request.id})">Accept</button>` : ''}
          ${request.status === 'Accepted' || request.status === 'Pending' ? `<button class="btn btn--sm btn--secondary" onclick="assignStaff(${request.id})">Assign</button>` : ''}
          ${request.status === 'In Progress' ? `<button class="btn btn--sm btn--primary" onclick="completeRequest(${request.id})">Complete</button>` : ''}
          ${request.status !== 'Completed' && request.status !== 'Cancelled' ? `<button class="btn btn--sm" style="background: var(--color-error); color: white;" onclick="cancelRequest(${request.id})">Cancel</button>` : ''}
        </div>
      </td>
    </tr>
  `).join('');
}

function viewRequestDetails(requestId) {
  const request = requests.find(r => r.id === requestId);
  const content = `
    <h3>Request Details</h3>
    <div class="bill-info">
      <div class="bill-row"><span>Request ID:</span><span>${request.id}</span></div>
      <div class="bill-row"><span>Customer:</span><span>${request.customerName}</span></div>
      <div class="bill-row"><span>Phone:</span><span>${request.phone}</span></div>
      <div class="bill-row"><span>Vehicle:</span><span>${request.vehicleType} - ${request.vehicleNumber}</span></div>
      <div class="bill-row"><span>Problem:</span><span>${request.problemType}</span></div>
      <div class="bill-row"><span>Description:</span><span>${request.description}</span></div>
      <div class="bill-row"><span>Location:</span><span>${request.latitude.toFixed(4)}, ${request.longitude.toFixed(4)}</span></div>
      <div class="bill-row"><span>Status:</span><span class="status-badge status-${request.status.toLowerCase().replace(' ', '-')}">${request.status}</span></div>
      <div class="bill-row"><span>Assigned Driver:</span><span>${request.assignedDriver || 'Not assigned'}</span></div>
      <div class="bill-row"><span>Assigned Mechanic:</span><span>${request.assignedMechanic || 'Not assigned'}</span></div>
      <div class="bill-row"><span>Created Date:</span><span>${request.createdDate}</span></div>
    </div>
    <div style="margin-top: 16px;">
      <h4>Location on Map</h4>
      <div class="map" style="height: 200px; position: relative;">
        <div class="map-grid"></div>
        <div class="map-marker" style="left: 50%; top: 50%; position: absolute; transform: translate(-50%, -100%);">üìç</div>
      </div>
    </div>
  `;
  showModal(content);
}

function acceptRequest(requestId) {
  const request = requests.find(r => r.id === requestId);
  if (request) {
    request.status = 'Accepted';
    renderRequestsTable();
    showNotification('Request accepted!', 'success');
  }
}

function assignStaff(requestId) {
  const request = requests.find(r => r.id === requestId);
  const drivers = staff.filter(s => s.type === 'Driver');
  const mechanics = staff.filter(s => s.type === 'Mechanic');

  const content = `
    <h3>Assign Staff</h3>
    <form id="assignStaffForm">
      <div class="form-group">
        <label class="form-label">Select Driver</label>
        <select class="form-control" id="assignDriver">
          <option value="">No driver</option>
          ${drivers.map(d => `<option value="${d.name}" ${!d.available ? 'disabled' : ''}>${d.name} ${!d.available ? '(Unavailable)' : ''}</option>`).join('')}
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Select Mechanic</label>
        <select class="form-control" id="assignMechanic">
          <option value="">No mechanic</option>
          ${mechanics.map(m => `<option value="${m.name}" ${!m.available ? 'disabled' : ''}>${m.name} ${!m.available ? '(Unavailable)' : ''}</option>`).join('')}
        </select>
      </div>
      <button type="button" class="btn btn--primary btn--full-width" onclick="confirmAssignment(${requestId})">Assign</button>
    </form>
  `;
  showModal(content);
}

function confirmAssignment(requestId) {
  const request = requests.find(r => r.id === requestId);
  const driverName = document.getElementById('assignDriver').value;
  const mechanicName = document.getElementById('assignMechanic').value;

  if (driverName) {
    request.assignedDriver = driverName;
    const driver = staff.find(s => s.name === driverName);
    if (driver) driver.available = false;
  }

  if (mechanicName) {
    request.assignedMechanic = mechanicName;
    const mechanic = staff.find(s => s.name === mechanicName);
    if (mechanic) mechanic.available = false;
  }

  if (driverName || mechanicName) {
    request.status = 'In Progress';
  }

  hideModal();
  renderRequestsTable();
  showNotification('Staff assigned successfully!', 'success');
}

function completeRequest(requestId) {
  const request = requests.find(r => r.id === requestId);
  if (request) {
    request.status = 'Completed';

    // Free up staff
    if (request.assignedDriver) {
      const driver = staff.find(s => s.name === request.assignedDriver);
      if (driver) driver.available = true;
    }
    if (request.assignedMechanic) {
      const mechanic = staff.find(s => s.name === request.assignedMechanic);
      if (mechanic) mechanic.available = true;
    }

    // Auto-generate bill
    const baseAmount = Math.floor(Math.random() * 3000) + 500;
    const additionalCharges = Math.floor(Math.random() * 500);
    const tax = Math.round((baseAmount + additionalCharges) * 0.18);
    const total = baseAmount + additionalCharges + tax;

    const bill = {
      id: nextBillId++,
      requestId: requestId,
      customerName: request.customerName,
      serviceType: request.problemType,
      baseAmount: baseAmount,
      additionalCharges: additionalCharges,
      tax: tax,
      total: total,
      status: 'Unpaid',
      createdDate: new Date().toISOString().split('T')[0]
    };
    bills.push(bill);

    renderRequestsTable();
    showNotification('Request completed and bill generated!', 'success');
  }
}

function cancelRequest(requestId) {
  const request = requests.find(r => r.id === requestId);
  if (request) {
    request.status = 'Cancelled';

    // Free up staff
    if (request.assignedDriver) {
      const driver = staff.find(s => s.name === request.assignedDriver);
      if (driver) driver.available = true;
    }
    if (request.assignedMechanic) {
      const mechanic = staff.find(s => s.name === request.assignedMechanic);
      if (mechanic) mechanic.available = true;
    }

    renderRequestsTable();
    showNotification('Request cancelled!', 'warning');
  }
}

function renderStaffTables() {
  const drivers = staff.filter(s => s.type === 'Driver');
  const mechanics = staff.filter(s => s.type === 'Mechanic');

  // Render drivers
  const driversTbody = document.querySelector('#driversTable tbody');
  driversTbody.innerHTML = drivers.map(driver => `
    <tr>
      <td>${driver.id}</td>
      <td>${driver.name}</td>
      <td>${driver.phone}</td>
      <td>${driver.email}</td>
      <td><span class="status-badge status-${driver.available ? 'available' : 'unavailable'}">${driver.available ? 'Available' : 'Unavailable'}</span></td>
      <td>
        <div class="action-buttons">
          <button class="btn btn--sm btn--secondary" onclick="toggleAvailability(${driver.id})">${driver.available ? 'Mark Unavailable' : 'Mark Available'}</button>
          <button class="btn btn--sm" style="background: var(--color-error); color: white;" onclick="removeStaff(${driver.id})">Remove</button>
        </div>
      </td>
    </tr>
  `).join('');

  // Render mechanics
  const mechanicsTbody = document.querySelector('#mechanicsTable tbody');
  mechanicsTbody.innerHTML = mechanics.map(mechanic => `
    <tr>
      <td>${mechanic.id}</td>
      <td>${mechanic.name}</td>
      <td>${mechanic.phone}</td>
      <td>${mechanic.email}</td>
      <td><span class="status-badge status-${mechanic.available ? 'available' : 'unavailable'}">${mechanic.available ? 'Available' : 'Unavailable'}</span></td>
      <td>
        <div class="action-buttons">
          <button class="btn btn--sm btn--secondary" onclick="toggleAvailability(${mechanic.id})">${mechanic.available ? 'Mark Unavailable' : 'Mark Available'}</button>
          <button class="btn btn--sm" style="background: var(--color-error); color: white;" onclick="removeStaff(${mechanic.id})">Remove</button>
        </div>
      </td>
    </tr>
  `).join('');
}

function showAddStaffModal() {
  const content = `
    <h3>Add Staff Member</h3>
    <form id="addStaffForm">
      <div class="form-group">
        <label class="form-label">Name *</label>
        <input type="text" class="form-control" id="staffName" required>
      </div>
      <div class="form-group">
        <label class="form-label">Phone Number *</label>
        <input type="tel" class="form-control" id="staffPhone" required>
      </div>
      <div class="form-group">
        <label class="form-label">Email *</label>
        <input type="email" class="form-control" id="staffEmail" required>
      </div>
      <div class="form-group">
        <label class="form-label">Type *</label>
        <select class="form-control" id="staffType" required>
          <option value="">Select type</option>
          <option value="Driver">Driver</option>
          <option value="Mechanic">Mechanic</option>
        </select>
      </div>
      <button type="button" class="btn btn--primary btn--full-width" onclick="addStaff()">Add Staff</button>
    </form>
  `;
  showModal(content);
}

function addStaff() {
  const name = document.getElementById('staffName').value;
  const phone = document.getElementById('staffPhone').value;
  const email = document.getElementById('staffEmail').value;
  const type = document.getElementById('staffType').value;

  if (!name || !phone || !email || !type) {
    showNotification('Please fill all fields!', 'error');
    return;
  }

  const newStaff = {
    id: nextStaffId++,
    name: name,
    phone: phone,
    email: email,
    type: type,
    available: true
  };

  staff.push(newStaff);
  hideModal();
  renderStaffTables();
  showNotification('Staff member added successfully!', 'success');
}

function toggleAvailability(staffId) {
  const member = staff.find(s => s.id === staffId);
  if (member) {
    member.available = !member.available;
    renderStaffTables();
    showNotification('Availability updated!', 'success');
  }
}

function removeStaff(staffId) {
  const index = staff.findIndex(s => s.id === staffId);
  if (index !== -1) {
    staff.splice(index, 1);
    renderStaffTables();
    showNotification('Staff member removed!', 'success');
  }
}

function renderBillsTable() {
  const tbody = document.querySelector('#billsTable tbody');
  tbody.innerHTML = bills.map(bill => `
    <tr>
      <td>${bill.id}</td>
      <td>${bill.requestId}</td>
      <td>${bill.customerName}</td>
      <td>${bill.serviceType}</td>
      <td>‚Çπ${bill.total}</td>
      <td>${bill.createdDate}</td>
      <td><span class="status-badge status-${bill.status.toLowerCase()}">${bill.status}</span></td>
      <td>
        <div class="action-buttons">
          <button class="btn btn--sm btn--outline" onclick="viewBillDetails(${bill.id})">View</button>
          <button class="btn btn--sm btn--secondary" onclick="downloadBill(${bill.id})">Download</button>
        </div>
      </td>
    </tr>
  `).join('');
}

function viewBillDetails(billId) {
  const bill = bills.find(b => b.id === billId);
  const content = `
    <h3>Bill Details</h3>
    <div class="bill-info">
      <div class="bill-row"><span>Bill ID:</span><span>${bill.id}</span></div>
      <div class="bill-row"><span>Request ID:</span><span>${bill.requestId}</span></div>
      <div class="bill-row"><span>Customer Name:</span><span>${bill.customerName}</span></div>
      <div class="bill-row"><span>Service Type:</span><span>${bill.serviceType}</span></div>
      <div class="bill-row"><span>Base Amount:</span><span>‚Çπ${bill.baseAmount}</span></div>
      <div class="bill-row"><span>Additional Charges:</span><span>‚Çπ${bill.additionalCharges}</span></div>
      <div class="bill-row"><span>Tax (18% GST):</span><span>‚Çπ${bill.tax}</span></div>
      <div class="bill-row total"><span>Total Amount:</span><span>‚Çπ${bill.total}</span></div>
      <div class="bill-row"><span>Status:</span><span class="status-badge status-${bill.status.toLowerCase()}">${bill.status}</span></div>
      <div class="bill-row"><span>Created Date:</span><span>${bill.createdDate}</span></div>
    </div>
  `;
  showModal(content);
}

function downloadBill(billId) {
  showNotification('Bill download started!', 'success');
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
  // Customer Navigation
  document.querySelectorAll('.nav-link').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const page = link.getAttribute('data-page');
      if (page) {
        showPage(page);
      }
    });
  });

  // Mobile nav toggle
  const navToggle = document.getElementById('navToggle');
  const navMenu = document.getElementById('navMenu');
  if (navToggle) {
    navToggle.addEventListener('click', () => {
      navMenu.classList.toggle('active');
    });
  }

  // Hero button
  document.getElementById('heroRequestBtn').addEventListener('click', () => {
    showPage('request-help');
  });

  // Admin login link
  document.getElementById('adminLoginLink').addEventListener('click', (e) => {
    e.preventDefault();
    showPage('admin-login');
  });

  // Admin login form
  document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);

  // Admin logout
  document.getElementById('adminLogout').addEventListener('click', (e) => {
    e.preventDefault();
    handleAdminLogout();
  });

  // Admin navigation
  document.querySelectorAll('.admin-nav-link').forEach(link => {
    link.addEventListener('click', (e) => {
      if (link.id !== 'adminLogout') {
        e.preventDefault();
        const page = link.getAttribute('data-page');
        if (page) {
          showPage(page);
        }
      }
    });
  });

  // Admin nav toggle (mobile)
  const adminNavToggle = document.getElementById('adminNavToggle');
  const adminNav = document.getElementById('admin-nav');
  if (adminNavToggle) {
    adminNavToggle.addEventListener('click', () => {
      adminNav.classList.toggle('active');
    });
  }

  // Request help form
  const requestForm = document.getElementById('requestHelpForm');
  if (requestForm) {
    requestForm.addEventListener('submit', handleRequestHelpSubmit);
    initRequestMap();
  }

  // Pay bill
  document.getElementById('loadBillBtn').addEventListener('click', loadBill);
  document.getElementById('paymentForm').addEventListener('submit', handlePayment);
  document.getElementById('submitReviewForm').addEventListener('submit', handleReviewSubmit);

  // Star rating
  document.querySelectorAll('.star').forEach(star => {
    star.addEventListener('click', () => {
      selectedRating = parseInt(star.getAttribute('data-rating'));
      document.getElementById('reviewRating').value = selectedRating;
      document.querySelectorAll('.star').forEach((s, index) => {
        if (index < selectedRating) {
          s.textContent = '‚òÖ';
          s.classList.add('active');
        } else {
          s.textContent = '‚òÜ';
          s.classList.remove('active');
        }
      });
    });
  });

  // Request filter
  document.getElementById('requestStatusFilter').addEventListener('change', (e) => {
    renderRequestsTable(e.target.value);
  });

  // Staff tabs
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tabName = btn.getAttribute('data-tab');
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById(tabName + '-tab').classList.add('active');
    });
  });

  // Add staff button
  document.getElementById('addStaffBtn').addEventListener('click', showAddStaffModal);

  // Modal close
  document.getElementById('modalClose').addEventListener('click', hideModal);

  // Close modal on outside click
  document.getElementById('modal').addEventListener('click', (e) => {
    if (e.target.id === 'modal') {
      hideModal();
    }
  });

  // Footer links
  document.querySelectorAll('.footer a').forEach(link => {
    link.addEventListener('click', (e) => {
      const page = link.getAttribute('data-page');
      if (page) {
        e.preventDefault();
        showPage(page);
      }
    });
  });

  // Initialize home page
  showPage('home');
});
    </script>
</body>
</html>
